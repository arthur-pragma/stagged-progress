<template id="stage-indicator-template">
    <link rel="stylesheet" href="/stage-indicator/stage-indicator.css">
    <div class="stage-indicator"></div>
</template>

<script>
    class StageIndicator extends HTMLElement {

        static get observedAttributes() {
            return ["type", "value"];
        };

        constructor() {
            super();
            
            this._type = null;
            this._value = null;
            this._stageIndicator = null;
        }

        get type() {
            return this.getAttribute("type") || this._type;
        };
        set type(value) {
            this._type = value;
        };

        get value() {
            return this.getAttribute("value") || this._value;
        };

        set value(value) {
            this._value = value;
        };

        connectedCallback() {
            
            const currentDocument = document.currentScript.ownerDocument;
            const template = currentDocument.querySelector('#stage-indicator-template').content.cloneNode(true);

            this.appendChild(template)

            this._stageIndicator = this.querySelector('.stage-indicator');
            this._stageIndicator.addEventListener("click", this.stageClicked);

            const type = this.getAttribute('type');
            const value = this.getAttribute('value');

            if(type !== null)
                this.setStageType(type);

            if(value !== null)
                this.setStagePosition(value);
        }

        disconnectedCallback() {
            _
         }      

        attributeChangedCallback(name, oldValue, newValue) {          

            switch (name) {

                case 'type':
                    this.setStageType(newValue);
                    break;
                case 'value':
                    this.setStagePosition(newValue)
                    break;
                default: break;
            }
        }

        stageClicked(e) {
            
            const progress = e.target.getAttribute('data-value');

            let event = new CustomEvent("UpdateProgress", {
                detail: {
                    progress: progress
                },
                bubbles: true
            });

            this.dispatchEvent(event);
        };

        setStageType(type) {                       

            if (this._stageIndicator !== null) {

                const types = ["major", "minor"];

                this._stageIndicator.classList.remove(...types);
                this._stageIndicator.classList.add(type);
            }
        }

        setStagePosition(value) {            

            if (this._stageIndicator !== null) {

                this._stageIndicator.setAttribute('data-value', value);
                this._stageIndicator.style.left = value + "%";
            }
        }

    }

    customElements.define('stage-indicator', StageIndicator);
</script>